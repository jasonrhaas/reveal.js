<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Ansible 101</title>

		<meta name="description" content="A gentle introduction to Ansible">
		<meta name="author" content="Jason Haas">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">

				<section>
					<h2>Ansible 101</h2>
					<p class="fragment">What is Ansible?</p>
					<p class="fragment">Why use Ansible?</p>
					<p class="fragment">Ansible code structure</p>
					<p class="fragment">Using Ansible in practice</p>

				</section>

				<section>
					<h2>What is Ansible?</h2>
					<p class="fragment">Framework that simplifies server provisioning.</p>
					<p class="fragment">Agentless</p>
					<p class="fragment">Open Source</p>
					<p class="fragment">Written in Python</p>
					<p class="fragment">Recently aquired by Red Hat</p>
					<h3 class="fragment">Requirements</h3>
					<p class="fragment">Linux, Mac OSX, Windows</p>
					<p class="fragment">ssh access to servers</p>
				</section>

				<section>
					<h2>Why use Ansible? (Pros)</h2>
					<p class="fragment">Infrastructure as code</p>
					<p class="fragment">Repeatable test environments - no snowflakes</p>
					<p class="fragment">Batteries included</p>
					<p class="fragment">Flexibility to scale </p>
					<p class="fragment">It forks</p>
				</section>

				<section>
					<h2>Ansible cons</h2>
					<img class="fragment" data-src="https://i.imgflip.com/yv0lm.jpg">
					<p class="fragment">Need to understand code base</p>
					<p class="fragment">Can get overly complex</p>
					<p class="fragment">It's fragile</p>
				</section>

				<section>
					<h2>Alternatives to Ansible</h2>
					<p class="fragment">Chef </p>
					<p class="fragment">Puppet </p>
					<p class="fragment">Salt </p>
				</section>

				<section data-background="http://www.ansible.com/hs-fs/hubfs/2015_Images/Blog/githubstars.png?t=1454970495302&width=613">
				</section>

				<section>
					<h2>How Ansible works</h2>
					<p>Chart from sysadmincasts.com</p>
				</section>

				<section data-background="https://d1cg27r99kkbpq.cloudfront.net/static/extra/43-ansible-multi-node-deployment-workflow.png">
				</section>

				<section>
					<h2>Ansible key components</h2>
					<p class="fragment">Inventories</p>
					<p class="fragment">Modules</p>
					<p class="fragment">Playbooks</p>
					<p class="fragment">Variables</p>
				</section>

				<section>
					<section>
						<h2>Inventories</h2>
						<p class="fragment">A file describing your server environment</p>
						<h3 class="fragment">Examples</h3>
						<p class="fragment">testing</p>
						<p class="fragment">staging</p>
						<p class="fragment">production</p>
					</section>

					<section data-markdown>
						<script type="text/template">
							## Example production inventory
							```
							[kafka-nodes]
							kafka01.your-company.com
							kafka02.your-company.com
							kafka03.your-company.com
							kafka04.your-company.com
							kafka05.your-company.com
							```
							Access all kafka nodes with {{ groups['kafka-nodes'] }}
						</script>
					</section>

				</section>

				<section>
					<h2>Modules</h2>
					<p class="fragment">Built in methods to Ansible</p>
					<h5 class="fragment">Examples:</h5>
					<p class="fragment">apt, yum</p>
					<p class="fragment">template</p>
					<p class="fragment">file</p>
					<p class="fragment">cron</p>

				</section>

				<section>
					<h2>Playbooks</h2>
					<p class="fragment">YAML file describing how to run plays</p>
					<p class="fragment">Plays can be standalone or in <em>roles</em></p>
					<p class="fragment">Using <em>roles</em> is encouraged for code re-use</p>
					<p class="fragment">... More detail later on</p>
				</section>

				<section>
					<section>
						<h2>Variables</h2>
						<p class="fragment">Variables are used for any value that may need to change.</p>
						<h4 class="fragment">Places variables can be set</h4>
						<p class="fragment">role defaults</p>
						<p class="fragment">role vars</p>
						<p class="fragment">playbook role vars</p>
						<p class="fragment">inventory vars</p>
						<p class="fragment">host_vars</p>
						<p class="fragment">group_vars</p>
						<p class="fragment">command line vars</p>
					</section>
					<section>
						<h2>Sooo many vars!</h2>
						<img data-src="http://memecrunch.com/meme/15FEP/confused-guy/image.jpg?w=551&c=1">
					</section>

					<section>
						<h2>Variable guidelines</h2>
						<p class="fragment">Role <em>defaults</em> are lowest precedence</p>
						<p class="fragment">Role <em>defaults</em> are "meant" to be overridden</p>
						<p class="fragment"><em>group_vars</em> for site specific variables, API keys, accounts</p>
						<p class="fragment"><em>host_vars</em> for host specific variables</p> 
						<p class="fragment"><code>--extra-vars</code> for command line one-off playbook runs</p>
					</section>
				</section>

				<section>
					<h2>Know your <strong>roles</strong></h2>
					<p class="fragment">Roles allow for "containerized" code</p>
					<p class="fragment">Think of roles as templates to deploy applications</p>
					<p class="fragment">You should use roles for everything possible</p>
				</section>

				<section>
					<section>
						<h2>Structure of a role</h2>
						<p class="fragment">defaults</p>
						<p class="fragment">handlers</p>
						<p class="fragment">meta</p>
						<p class="fragment">tasks</p>
						<p class="fragment">templates</p>
						<p class="fragment">vars</p>
					</section>
					<section>
						<h2>defaults</h2>
						<p>roles/kafka/defaults/main.yml</p>
						<pre><code>
---
kafka_scala_version: 2.11
kafka_version: 0.9.0.0
kafka_install_dir: /opt/kafka
kafka_config_dir: /opt/kafka/default/config
kafka_log_dir: /opt/kafka/default/logs
kafka_data_log_dir:
  - "/opt/kafka/topic-logs"
kafka_port: 9092
kafka_message_max: 10000000
kafka_replica_fetch_max_bytes: 15000000
kafka_consumer_message_max: 16777216
kafka_num_partitions: "{{ groups['kafka-nodes'] | length }}"
kafka_replication_factor: "{{ groups['kafka-nodes'] | length }}"
kafka_log_retention_hours: 168
kafka_num_io_threads: 8
repository_infrastructure: "{{ apache_mirror }}/kafka/{{ kafka_version }}"
						</code></pre>
					</section>

					<section>
						<h2>handlers</h2>
						<p>Handles service start/stop/restarts</p>
						<p>If a file gets changed multiple times, only reboot once</p>
						<pre><code>
---
- name: restart kafka
   supervisorctl:
     name: kafka
     state: restarted
     					</code></pre>
					</section>

					<section>
						<h2>meta</h2>
						<p>Any roles that are dependencies</p>
						<pre><code>
---
dependencies:
  - { role: supervisord, when: "supervisord_has_run is not defined" }
  - { role: java, when: "java_has_run is not defined" }
  						</code></pre>
					</section>

					<section>
						<h2>tasks</h2>
						<p>Sequential list of plays</p>
						<pre><code>
- name: configure kafka brokers
  template:
    src=server.properties.j2
    dest={{ kafka_config_dir }}/server.properties
    mode=0644
  notify:
    - restart kafka
  tags: kafka
  						</code></pre>
					</section>

					<section>
						<h2>templates</h2>
						<p>Good for using variables in configuration files</p>
						<pre><code>
port={{ kafka_port }}
host.name={{ inventory_hostname }}
advertised.host.name={{ inventory_hostname }}
advertised.port={{ kafka_port }}
						</code></pre>
					</section>

					<section>
						<h2>vars</h2>
						<p>A good use for this is RedHat vs. Debian vars</p>
						<p>Can do things like:</p>
						<pre><code>
# Include variables and define needed variables.
- name: Include OS-specific variables.
  include_vars: "{{ ansible_os_family }}.yml"
						</code></pre>
						<p>Correct vars for each linux distro</p>
					</section>

				</section>

				<section>
					<h2>Playbook guidelines</h2>
					<p class="fragment">Use a top level playbook and tags</p>
					<p class="fragment">Don't bother with one off individual playbooks</p>

				</section>

				<section>
					<h2>Ansible-Symphony</h2>
					<p class="fragment">IST's open source Ansible repo</p>
					<h4 class="fragment">Some tools included</h3>
					<p class="fragment">Hadoop</p>
					<p class="fragment">HBase</p>
					<p class="fragment">Spark</p>
					<p class="fragment">Elastic Search</p>
					<p class="fragment">Kafka</p>

				</section>

				<section>
					<h2>Lets run some code!</h2>
					<p>1. Ad-hoc commands cluster</p>
					<p>2. Walk through of simple role</p>
					<h5>sidenote: don't test ansible code in prod!</h5>
				</section>

				<section>
					<h2>Resources</h2>
					<p>docs.ansible.com</p>
					<p>sysadmincasts.com</p>
					<p>github.com/istresearch/ansible-symphony</p>
					<p>blog.jasonrhaas.com</p>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				slideNumber: 'c/t',

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
